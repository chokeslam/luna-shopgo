{"version":3,"file":"shipping-pricing.js","names":["ref","onMounted","computed","createApp","toRefs","reactive","Vue","ShippingPricing","name","props","pricing","Object","setup","u","$ui","iframeModal","state","global","free","getEmptyPricing","locationCategories","locations","currentItem","selectModal","pricingModal","openLocationCategorySelector","url","route","callback","window","locationCategorySelected","value","id","title","push","close","open","size","openLocationSelector","locationSelected","path","configurePricing","item","bootstrap","modal","show","seg","getEmptyPricingSegment","threshold","ShopgoVueUtilities","prepareVueItem","fee","addPricingSegment","i","splice","removePricingSegment","finalResult","JSON","stringify","create","el","getAttribute","app","data","use","ShopGoVuePlugin","component","vuedraggable","mount"],"sources":["field/shipping-pricing.js"],"sourcesContent":["/**\n * Part of shopgo project.\n *\n * @copyright  Copyright (C) 2023 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\n// App\nconst { ref, onMounted, computed, createApp, toRefs, reactive } = Vue;\n\nconst ShippingPricing = {\n  name: 'ShippingPricingApp',\n  props: {\n    pricing: Object\n  },\n  setup(props) {\n    u.$ui.iframeModal();\n\n    const state = reactive({\n      global: props.pricing?.global || {\n        free: false,\n        pricing: getEmptyPricing()\n      },\n      locationCategories: props.pricing?.locationCategories || [],\n      locations: props.pricing?.locations || [],\n      currentItem: null,\n    });\n\n    const selectModal = ref(null);\n    const pricingModal = ref(null);\n\n    function openLocationCategorySelector() {\n      const url = u.route('category_modal', { callback: 'locationCategorySelected' });\n\n      window.locationCategorySelected = function ({ value: id, title }) {\n        state.locationCategories.push({\n          id,\n          title,\n          free: false,\n          pricing: getEmptyPricing(),\n        });\n\n        selectModal.value.close();\n      }\n\n      selectModal.value.open(url, { size: 'modal-xl' });\n    }\n\n    function openLocationSelector() {\n      const url = u.route('location_modal', { callback: 'locationSelected' });\n\n      window.locationSelected = function ({ value: id, title, path }) {\n\n        state.locations.push({\n          id,\n          title,\n          path,\n          free: false,\n          pricing: getEmptyPricing(),\n        });\n\n        selectModal.value.close();\n      }\n\n      selectModal.value.open(url, { size: 'modal-xl' });\n    }\n\n    function configurePricing(item) {\n      state.currentItem = item;\n\n      u.$ui.bootstrap.modal(pricingModal.value).show();\n    }\n\n    function getEmptyPricing() {\n      const seg = getEmptyPricingSegment();\n      seg.threshold = 0;\n\n      return [seg];\n    }\n\n    function getEmptyPricingSegment() {\n      return ShopgoVueUtilities.prepareVueItem(\n        {\n          threshold: '',\n          fee: '',\n        }\n      );\n    }\n\n    function addPricingSegment(i = 0) {\n      state.currentItem.pricing.splice(i + 1, 0, getEmptyPricingSegment());\n    }\n\n    function removePricingSegment(i) {\n      state.currentItem.pricing.splice(i, 1);\n    }\n\n    const finalResult = computed(() => {\n      return JSON.stringify(\n        {\n          global: state.global,\n          locationCategories: state.locationCategories,\n          locations: state.locations,\n        }\n      );\n    });\n\n    return {\n      ...toRefs(state),\n      finalResult,\n      selectModal,\n      pricingModal,\n\n      openLocationSelector,\n      openLocationCategorySelector,\n      configurePricing,\n      addPricingSegment,\n      removePricingSegment,\n    };\n  },\n\n  create(el) {\n    const id = el.getAttribute('id');\n\n    const app = createApp(\n      this,\n      u.data(id + '.props')\n    );\n\n    app.use(ShopGoVuePlugin);\n    app.component('draggable', vuedraggable);\n    app.mount(el);\n  },\n};\n\nwindow.ShippingPricing = ShippingPricing;\n"],"mappings":"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"}