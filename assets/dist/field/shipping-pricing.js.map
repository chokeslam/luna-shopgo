{"version":3,"sources":["field/shipping-pricing.js"],"names":["System","register","_export","_context","ref","onMounted","computed","createApp","toRefs","reactive","ShippingPricing","setters","execute","Vue","Object","_props$pricing","_props$pricing2","_props$pricing3","name","state","props","pricing","global","getEmptyPricing","locationCategories","$ui","iframeModal","locations","currentItem","free","seg","getEmptyPricingSegment","threshold","configurePricing","bootstrap","ShopgoVueUtilities","prepareVueItem","fee","finalResult","addPricingSegment","JSON","arguments","length","removePricingSegment","selectModal","pricingModal","openLocationSelector","value","close","callback","window","locationSelected","_ref2","id","title","path","push","open","url","size","openLocationCategorySelector","locationCategorySelected","_ref","item","u","modal","show","i","undefined","splice","create","this","data","app","mount","el","getAttribute"],"mappings":"AAAAA,OAAOC,SAAS,IAAI,SAAUC,EAASC,GAGrC,IAAIC,EAAKC,EAAWC,EAAUC,EAAWC,EAAQC,EAAUC,EAC3D,MAAO,CACLC,QAAS,GACTC,QAAS,aALbR,MACAC,YACAC,WACAC,YACAC,SAEAC,YACMI,KAOAH,EAPK,CAAEL,KAAAA,qBAAWC,MAAAA,CAAUC,QAASO,QAAUL,MAAAA,GAAaI,IAAGE,EAAAC,EAAAC,EAE/DP,EAAAA,IAAAA,cACJQ,MAAMC,EAAAV,EAAA,CACNW,QAAO,QAAAL,EAAAK,EAAAC,eAAA,IAAAN,OAAA,EAAAA,EAAAO,SAAA,CACLD,MAASP,EACVO,QAAAE,KACYC,oBAAA,QAAAR,EAAAC,EAAAA,eAAA,IAAAD,OAAA,EAAAA,EAAAQ,qBAAA,GACTC,WAAiB,QAAbC,EAAaN,EAAAC,eAAA,IAAAJ,OAAA,EAAAA,EAAAU,YAAA,GAEnBC,YAAcnB,OAEVoB,EAAWzB,EAAA,MACXiB,EAASE,EAAAA,MA6DP,SAlB8BA,IAAa,MAAEO,EAAAC,IAGnD,OAFAD,EAAAE,UAAA,EAESC,CAAAA,EAmBH,CACA,SAjBEC,IACR,OAAAC,mBAAAC,eAAA,CAEAJ,UAAST,GACPc,IAAMP,IAkBF,CAHN,MAAAQ,EAASC,GAAyB,IAANC,KAAAC,UAAAC,CAC1BvB,OAAMS,EAAAA,OACRJ,mBAAAL,EAAAK,mBAEAG,UAASgB,EAAAA,cAIT,MAAML,IACJ9B,EAAOgC,GAWDF,cACAM,cACAC,eARJC,qBAhDE,WACE,MAdJF,EAAAA,EAAYG,MAAMC,iBAAO,CAC1BC,SAAA,qBAgBKC,OAd4BC,iBAAE,SAAAC,GAAa,IACnDL,MAAAM,EAAAC,MAEAA,EAASR,KACPS,GAAwCN,EAA+B9B,EAAAQ,UAAA6B,KAAA,CAEvEN,KAAgEI,QAA1BP,OAAWO,MAAK,EAAEC,QAAAA,MAEtDpC,EAAMQ,MAAU6B,OAoBZ,EACAZ,EAnBGG,MAAAU,KAAAC,EAAA,CAoBDC,KAnBA,YAqBJ,EA4BJC,6BAvEI,WAXJpC,MAAAA,EAAAA,EAAAA,MAAoB,iBAAA,CACpBG,SAAW,6BAEXuB,OAAAW,yBAAA,SAAAC,GAEF,IACMjB,MAAAA,EAAAA,MAENS,GACQI,EAAkCT,EAAAA,mBAAUO,KAAA,CAA6BH,KAE/EH,QAAkErB,MAAtB,EAAEkB,QAASxB,MAAQqB,EAACG,MAAAC,OAgB1D,EACAJ,EAfAG,MAAAU,KAAAC,EAAA,CAgBEC,KAfJL,YAiBA,EAqDNrB,iBA7BM,SAnBA8B,GAoBE5C,EAlBJyB,YAAkBI,EACpBgB,EAACvC,IAAAS,UAAA+B,MAAApB,EAAAE,OAAAmB,MAmBG,EA2BJ3B,kBA9BF,WAEA,IAAA4B,EAASpC,UAAAA,OAAAA,QAAyBqC,IAAA3B,UAAA,GAAAA,UAAA,GAAA,EAChCtB,EAAAS,YAAOO,QAAmBC,OAAAA,EAAAA,EAAc,EACtCL,IAcE,EAaJO,qBAZI,SAbK6B,GACPhD,EACDS,YAAAP,QAAAgD,OAAAF,EAAA,EACH,EA+BI,EACAG,OANFxB,GAOI,MANJc,EAAAA,EAAAA,aAAAA,MACA3B,EAAAA,EAAgBsC,KAAAP,EAAAQ,KAAAnB,EAAA,WAOZoB,EANJlC,IAAAA,iBAOIkC,EANJ9B,UAAAA,YAAAA,cACF8B,EAACC,MAAAC,EACH,GAQIzB,OALFxC,gBAAckE,CAMd,EAEJ","file":"shipping-pricing.js","sourcesContent":["/**\n * Part of shopgo project.\n *\n * @copyright  Copyright (C) 2023 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\n// App\nconst { ref, onMounted, computed, createApp, toRefs, reactive } = Vue;\n\nconst ShippingPricing = {\n  name: 'ShippingPricingApp',\n  props: {\n    pricing: Object\n  },\n  setup(props) {\n    u.$ui.iframeModal();\n\n    const state = reactive({\n      global: props.pricing?.global || {\n        free: false,\n        pricing: getEmptyPricing()\n      },\n      locationCategories: props.pricing?.locationCategories || [],\n      locations: props.pricing?.locations || [],\n      currentItem: null,\n    });\n\n    const selectModal = ref(null);\n    const pricingModal = ref(null);\n\n    function openLocationCategorySelector() {\n      const url = u.route('category_modal', { callback: 'locationCategorySelected' });\n\n      window.locationCategorySelected = function ({ value: id, title }) {\n        state.locationCategories.push({\n          id,\n          title,\n          free: false,\n          pricing: getEmptyPricing(),\n        });\n\n        selectModal.value.close();\n      }\n\n      selectModal.value.open(url, { size: 'modal-xl' });\n    }\n\n    function openLocationSelector() {\n      const url = u.route('location_modal', { callback: 'locationSelected' });\n\n      window.locationSelected = function ({ value: id, title, path }) {\n\n        state.locations.push({\n          id,\n          title,\n          path,\n          free: false,\n          pricing: getEmptyPricing(),\n        });\n\n        selectModal.value.close();\n      }\n\n      selectModal.value.open(url, { size: 'modal-xl' });\n    }\n\n    function configurePricing(item) {\n      state.currentItem = item;\n\n      u.$ui.bootstrap.modal(pricingModal.value).show();\n    }\n\n    function getEmptyPricing() {\n      const seg = getEmptyPricingSegment();\n      seg.threshold = 0;\n\n      return [seg];\n    }\n\n    function getEmptyPricingSegment() {\n      return ShopgoVueUtilities.prepareVueItem(\n        {\n          threshold: '',\n          fee: '',\n        }\n      );\n    }\n\n    function addPricingSegment(i = 0) {\n      state.currentItem.pricing.splice(i + 1, 0, getEmptyPricingSegment());\n    }\n\n    function removePricingSegment(i) {\n      state.currentItem.pricing.splice(i, 1);\n    }\n\n    const finalResult = computed(() => {\n      return JSON.stringify(\n        {\n          global: state.global,\n          locationCategories: state.locationCategories,\n          locations: state.locations,\n        }\n      );\n    });\n\n    return {\n      ...toRefs(state),\n      finalResult,\n      selectModal,\n      pricingModal,\n\n      openLocationSelector,\n      openLocationCategorySelector,\n      configurePricing,\n      addPricingSegment,\n      removePricingSegment,\n    };\n  },\n\n  create(el) {\n    const id = el.getAttribute('id');\n\n    const app = createApp(\n      this,\n      u.data(id + '.props')\n    );\n\n    app.use(ShopGoVuePlugin);\n    app.component('draggable', vuedraggable);\n    app.mount(el);\n  },\n};\n\nwindow.ShippingPricing = ShippingPricing;\n"]}