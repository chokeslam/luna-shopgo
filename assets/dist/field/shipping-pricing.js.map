{"version":3,"file":"shipping-pricing.js","names":["ref","onMounted","computed","createApp","toRefs","reactive","Vue","ShippingPricing","name","props","pricing","Object","setup","_props$pricing","_props$pricing2","_props$pricing3","u","$ui","iframeModal","state","global","free","getEmptyPricing","locationCategories","locations","currentItem","selectModal","pricingModal","openLocationCategorySelector","url","route","callback","window","locationCategorySelected","_ref","value","id","title","push","close","open","size","openLocationSelector","locationSelected","_ref2","path","configurePricing","item","bootstrap","modal","show","seg","getEmptyPricingSegment","threshold","ShopgoVueUtilities","prepareVueItem","fee","addPricingSegment","i","arguments","length","undefined","splice","removePricingSegment","finalResult","JSON","stringify","create","el","getAttribute","app","data","use","ShopGoVuePlugin","component","vuedraggable","mount"],"sources":["field/shipping-pricing.js"],"sourcesContent":["/**\n * Part of shopgo project.\n *\n * @copyright  Copyright (C) 2023 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\n// App\nconst { ref, onMounted, computed, createApp, toRefs, reactive } = Vue;\n\nconst ShippingPricing = {\n  name: 'ShippingPricingApp',\n  props: {\n    pricing: Object\n  },\n  setup(props) {\n    u.$ui.iframeModal();\n\n    const state = reactive({\n      global: props.pricing?.global || {\n        free: false,\n        pricing: getEmptyPricing()\n      },\n      locationCategories: props.pricing?.locationCategories || [],\n      locations: props.pricing?.locations || [],\n      currentItem: null,\n    });\n\n    const selectModal = ref(null);\n    const pricingModal = ref(null);\n\n    function openLocationCategorySelector() {\n      const url = u.route('category_modal', { callback: 'locationCategorySelected' });\n\n      window.locationCategorySelected = function ({ value: id, title }) {\n        state.locationCategories.push({\n          id,\n          title,\n          free: false,\n          pricing: getEmptyPricing(),\n        });\n\n        selectModal.value.close();\n      }\n\n      selectModal.value.open(url, { size: 'modal-xl' });\n    }\n\n    function openLocationSelector() {\n      const url = u.route('location_modal', { callback: 'locationSelected' });\n\n      window.locationSelected = function ({ value: id, title, path }) {\n\n        state.locations.push({\n          id,\n          title,\n          path,\n          free: false,\n          pricing: getEmptyPricing(),\n        });\n\n        selectModal.value.close();\n      }\n\n      selectModal.value.open(url, { size: 'modal-xl' });\n    }\n\n    function configurePricing(item) {\n      state.currentItem = item;\n\n      u.$ui.bootstrap.modal(pricingModal.value).show();\n    }\n\n    function getEmptyPricing() {\n      const seg = getEmptyPricingSegment();\n      seg.threshold = 0;\n\n      return [seg];\n    }\n\n    function getEmptyPricingSegment() {\n      return ShopgoVueUtilities.prepareVueItem(\n        {\n          threshold: '',\n          fee: '',\n        }\n      );\n    }\n\n    function addPricingSegment(i = 0) {\n      state.currentItem.pricing.splice(i + 1, 0, getEmptyPricingSegment());\n    }\n\n    function removePricingSegment(i) {\n      state.currentItem.pricing.splice(i, 1);\n    }\n\n    const finalResult = computed(() => {\n      return JSON.stringify(\n        {\n          global: state.global,\n          locationCategories: state.locationCategories,\n          locations: state.locations,\n        }\n      );\n    });\n\n    return {\n      ...toRefs(state),\n      finalResult,\n      selectModal,\n      pricingModal,\n\n      openLocationSelector,\n      openLocationCategorySelector,\n      configurePricing,\n      addPricingSegment,\n      removePricingSegment,\n    };\n  },\n\n  create(el) {\n    const id = el.getAttribute('id');\n\n    const app = createApp(\n      this,\n      u.data(id + '.props')\n    );\n\n    app.use(ShopGoVuePlugin);\n    app.component('draggable', vuedraggable);\n    app.mount(el);\n  },\n};\n\nwindow.ShippingPricing = ShippingPricing;\n"],"mappings":"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"}