System.register(["@main"],(function(t,a){async function e(t){const a=t.dataset.id;if(!a)throw new Error("No product ID");const e=t.dataset.variantId;if(!e)throw new Error("No variant ID");const n=document.querySelector("[data-role=quantity]"),r=Number((null==n?void 0:n.value)||1),c=function(){const t=u.selectAll("[data-role=attachment]"),a={};for(const e of t){const t=e.querySelector("[data-role=attachment_id]"),n=e.querySelector("[data-role=attachment_quantity]");t.checked&&(a[t.value]=Number(n.value))}return a}();try{const t=await u.$http.post("@cart_ajax/addToCart",{product_id:a,variant_id:e,quantity:r,attachments:c});return function(t){const a=t.length;u.trigger("cart.update",t,a),document.dispatchEvent(new CustomEvent("cart.update",{detail:{data:t,count:a}}));const e=document.querySelectorAll("[data-role=cart-button]");for(const n of e){const e=n.querySelector("[data-role=cart-quantity]");n.classList.toggle("h-has-items",a>0),e.textContent=a,n.dispatchEvent(new CustomEvent("cart.update",{detail:{data:t,count:a}}))}}(t.data.data),t.data}catch(t){throw console.error(t),t}}function n(){location.href=u.route("cart")}return{setters:[function(t){}],execute:function(){u.delegate(document,"[data-task=add-to-cart]","click",(t=>{!async function(t){try{await e(t)}catch(t){return void u.alert(t.message,"","warning")}await swal({title:"已加入購物車",buttons:["繼續購物","前往結帳"]})&&n()}(t.currentTarget)})),u.delegate(document,"[data-task=buy]","click",(t=>{!async function(t){try{await e(t)}catch(t){return void u.alert(t.message,"","warning")}n()}(t.currentTarget)}))}}}));
//# sourceMappingURL=product-cart.js.map
