{"version":3,"file":"product-cart.js","names":["sendAddAction","el","productId","dataset","id","Error","variantId","qtyInput","document","querySelector","res","u","$http","post","product_id","variant_id","quantity","Number","value","updateCartButton","data","e","console","error","alert","message","addToCart","v","swal","title","buttons","toCartPage","addon","apMapId","buy","location","href","route","trigger","count","length","$cartButtons","querySelectorAll","$cartButton","$cartQuantity","classList","toggle","textContent","delegate","target"],"sources":["product-cart.js"],"sourcesContent":["/**\n * Part of shopgo project.\n *\n * @copyright  Copyright (C) 2023 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nu.delegate(document, '[data-task=add-to-cart]', 'click', (e) => {\n  addToCart(e.target);\n});\n\nu.delegate(document, '[data-task=buy]', 'click', (e) => {\n  buy(e.target);\n});\n\nu.delegate(document, '[data-task=addon]', 'click', (e) => {\n  addon(e.target);\n});\n\nasync function sendAddAction(el) {\n  const productId = el.dataset.id;\n\n  if (!productId) {\n    throw new Error('No product ID');\n  }\n\n  const variantId = el.dataset.variantId;\n\n  if (!variantId) {\n    throw new Error('No variant ID');\n  }\n\n  const qtyInput = document.querySelector('[data-role=quantity]');\n\n  try {\n    const res = await u.$http.post(\n      '@cart_ajax/addToCart',\n      {\n        product_id: productId,\n        variant_id: variantId,\n        quantity: Number(qtyInput.value)\n      }\n    );\n\n    updateCartButton(res.data.data);\n\n    return res.data;\n  } catch (e) {\n    console.error(e);\n    u.alert(e.message, '', 'warning');\n  }\n}\n\nasync function addToCart(el) {\n  try {\n    sendAddAction(el);\n  } catch (e) {\n    u.alert(e.message, '', 'warning');\n    return;\n  }\n\n  const v = await swal({\n    title: '已加入購物車',\n    buttons: [\n      '繼續購物',\n      '前往結帳'\n    ]\n  });\n\n  if (!v) {\n    return;\n  }\n\n  toCartPage();\n}\n\nasync function addon(el) {\n  const apMapId = el.dataset.apMapId;\n\n  try {\n    const res = await u.$http.post(\n      '@cart_ajax/addon',\n      {\n        apMapId\n      }\n    );\n\n    updateCartButton(res.data.data);\n\n    swal({ title: '已加購' });\n\n    return res.data;\n  } catch (e) {\n    console.error(e);\n    u.alert(e.message, '', 'warning');\n  }\n}\n\nfunction buy(el) {\n  try {\n    sendAddAction(el);\n  } catch (e) {\n    u.alert(e.message, '', 'warning');\n    return;\n  }\n\n  toCartPage();\n}\n\nfunction toCartPage() {\n  location.href = u.route('cart');\n}\n\nfunction updateCartButton(data) {\n  u.trigger('cart.update', data);\n\n  const count = data.length;\n\n  const $cartButtons = document.querySelectorAll('[data-role=cart-button]');\n\n  for (const $cartButton of $cartButtons) {\n    const $cartQuantity = $cartButton.querySelector('[data-role=cart-quantity]');\n\n    $cartButton.classList.toggle('h-has-items', count > 0);\n    $cartQuantity.textContent = count;\n  }\n}\n"],"mappings":"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"}