{"version":3,"sources":["product-cart.js"],"names":["System","register","_export","_context","async","sendAddAction","el","productId","dataset","id","Error","variantId","qtyInput","document","querySelector","res","u","$http","post","product_id","variant_id","quantity","Number","value","updateCartButton","data","e","console","error","alert","message","toCartPage","location","href","route","trigger","count","length","$cartButtons","querySelectorAll","$cartButton","$cartQuantity","classList","toggle","textContent","setters","_main","execute","delegate","swal","title","buttons","addToCart","target","buy","apMapId"],"mappings":"AAAAA,OAAOC,SAAS,CAAC,UAAU,SAAUC,EAASC,GAqB9CC,eAAeC,EAAcC,GAC3B,MAAMC,EAAYD,EAAGE,QAAQC,GAE7B,IAAKF,EACH,MAAM,IAAIG,MAAM,iBAGlB,MAAMC,EAAYL,EAAGE,QAAQG,UAE7B,IAAKA,EACH,MAAM,IAAID,MAAM,iBAGlB,MAAME,EAAWC,SAASC,cAAc,wBAExC,IACE,MAAMC,QAAYC,EAAEC,MAAMC,KACxB,uBACA,CACEC,WAAYZ,EACZa,WAAYT,EACZU,SAAUC,QAAOV,aAAQ,EAARA,EAAUW,QAAS,KAMxC,OAFAC,EAAiBT,EAAIU,KAAKA,MAEnBV,EAAIU,IAIb,CAHE,MAAOC,GACPC,QAAQC,MAAMF,GACdV,EAAEa,MAAMH,EAAEI,QAAS,GAAI,UACzB,CACF,CA0DA,SAASC,IACPC,SAASC,KAAOjB,EAAEkB,MAAM,OAC1B,CAEA,SAASV,EAAiBC,GACxBT,EAAEmB,QAAQ,cAAeV,GAEzB,MAAMW,EAAQX,EAAKY,OAEbC,EAAezB,SAAS0B,iBAAiB,2BAE/C,IAAK,MAAMC,KAAeF,EAAc,CACtC,MAAMG,EAAgBD,EAAY1B,cAAc,6BAEhD0B,EAAYE,UAAUC,OAAO,cAAeP,EAAQ,GACpDK,EAAcG,YAAcR,CAC9B,CACF,CAAC,MAAA,CAAAS,QAAA,CAAA,SAAAC,GAAA,GAAAC,QAAA,WA/HD/B,EAAAgC,SAAAnC,SAAA,0BAAA,SAAAa,KAsDAtB,eAAyBE,GACvB,IACED,EAAcC,EAIhB,CAHE,MAAOoB,GAEP,YADAV,EAAEa,MAAMH,EAAEI,QAAS,GAAI,UAEzB,OAEgBmB,KAAK,CACnBC,MAAO,SACPC,QAAS,CACP,OACA,WAQJpB,GACF,CA1EAqB,CAAA1B,EAAA2B,OAAA,IAEArC,EAAAgC,SAAAnC,SAAA,kBAAA,SAAAa,KAgGA,SAAapB,GACX,IACED,EAAcC,EAIhB,CAHE,MAAOoB,GAEP,YADAV,EAAEa,MAAMH,EAAEI,QAAS,GAAI,UAEzB,CAEAC,GACF,CAxGAuB,CAAA5B,EAAA2B,OAAA,IAIArC,EAAEgC,SAASnC,SAAU,oBAAA,SAA2Ba,KAqEhDtB,eAAqBE,GACnB,MAAMiD,EAAUjD,EAAGE,QAAQ+C,QAE3B,IACE,MAAMxC,QAAYC,EAAEC,MAAMC,KACxB,mBACA,CACEqC,YAIJ/B,EAAiBT,EAAIU,KAAKA,MAE1BwB,KAAK,CAAEC,MAAO,QAEPnC,EAAIU,IAIb,CAHE,MAAOC,GACPC,QAAQC,MAAMF,GACdV,EAAEa,MAAMH,EAAEI,QAAS,GAAI,UACzB,CACF,CAxFEsB,CAAAA,EAAAA,OAAYC,GAmFV,EAEJ","file":"product-cart.js","sourcesContent":["/**\n * Part of shopgo project.\n *\n * @copyright  Copyright (C) 2023 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nu.delegate(document, '[data-task=add-to-cart]', 'click', (e) => {\n  addToCart(e.target);\n});\n\nu.delegate(document, '[data-task=buy]', 'click', (e) => {\n  buy(e.target);\n});\n\nu.delegate(document, '[data-task=addon]', 'click', (e) => {\n  addon(e.target);\n});\n\nasync function sendAddAction(el) {\n  const productId = el.dataset.id;\n\n  if (!productId) {\n    throw new Error('No product ID');\n  }\n\n  const variantId = el.dataset.variantId;\n\n  if (!variantId) {\n    throw new Error('No variant ID');\n  }\n\n  const qtyInput = document.querySelector('[data-role=quantity]');\n\n  try {\n    const res = await u.$http.post(\n      '@cart_ajax/addToCart',\n      {\n        product_id: productId,\n        variant_id: variantId,\n        quantity: Number(qtyInput?.value || 1)\n      }\n    );\n\n    updateCartButton(res.data.data);\n\n    return res.data;\n  } catch (e) {\n    console.error(e);\n    u.alert(e.message, '', 'warning');\n  }\n}\n\nasync function addToCart(el) {\n  try {\n    sendAddAction(el);\n  } catch (e) {\n    u.alert(e.message, '', 'warning');\n    return;\n  }\n\n  const v = await swal({\n    title: '已加入購物車',\n    buttons: [\n      '繼續購物',\n      '前往結帳'\n    ]\n  });\n\n  if (!v) {\n    return;\n  }\n\n  toCartPage();\n}\n\nasync function addon(el) {\n  const apMapId = el.dataset.apMapId;\n\n  try {\n    const res = await u.$http.post(\n      '@cart_ajax/addon',\n      {\n        apMapId\n      }\n    );\n\n    updateCartButton(res.data.data);\n\n    swal({ title: '已加購' });\n\n    return res.data;\n  } catch (e) {\n    console.error(e);\n    u.alert(e.message, '', 'warning');\n  }\n}\n\nfunction buy(el) {\n  try {\n    sendAddAction(el);\n  } catch (e) {\n    u.alert(e.message, '', 'warning');\n    return;\n  }\n\n  toCartPage();\n}\n\nfunction toCartPage() {\n  location.href = u.route('cart');\n}\n\nfunction updateCartButton(data) {\n  u.trigger('cart.update', data);\n\n  const count = data.length;\n\n  const $cartButtons = document.querySelectorAll('[data-role=cart-button]');\n\n  for (const $cartButton of $cartButtons) {\n    const $cartQuantity = $cartButton.querySelector('[data-role=cart-quantity]');\n\n    $cartButton.classList.toggle('h-has-items', count > 0);\n    $cartQuantity.textContent = count;\n  }\n}\n"]}