{"version":3,"file":"product-cart.js","names":["sendAddAction","el","productId","dataset","id","Error","hash","qtyInput","document","querySelector","res","u","$http","post","product_id","quantity","Number","value","updateCartButton","data","e","console","error","alert","message","addToCart","v","swal","title","buttons","toCartPage","addon","apMapId","buy","location","href","route","trigger","count","length","$cartButtons","querySelectorAll","$cartButton","$cartQuantity","classList","toggle","textContent","delegate","target"],"sources":["product-cart.js"],"sourcesContent":["/**\n * Part of shopgo project.\n *\n * @copyright  Copyright (C) 2023 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nu.delegate(document, '[data-task=add-to-cart]', 'click', (e) => {\n  addToCart(e.target);\n});\n\nu.delegate(document, '[data-task=buy]', 'click', (e) => {\n  buy(e.target);\n});\n\nu.delegate(document, '[data-task=addon]', 'click', (e) => {\n  addon(e.target);\n});\n\nasync function sendAddAction(el) {\n  const productId = el.dataset.id;\n\n  if (!productId) {\n    throw new Error('No product ID');\n  }\n\n  const hash = el.dataset.hash;\n\n  if (!hash) {\n    throw new Error('No variant hash');\n  }\n\n  const qtyInput = document.querySelector('[data-role=quantity]');\n\n  try {\n    const res = await u.$http.post(\n      '@cart_ajax/addToCart',\n      {\n        product_id: productId,\n        hash,\n        quantity: Number(qtyInput.value)\n      }\n    );\n\n    updateCartButton(res.data.data);\n\n    return res.data;\n  } catch (e) {\n    console.error(e);\n    u.alert(e.message, '', 'warning');\n  }\n}\n\nasync function addToCart(el) {\n  sendAddAction(el);\n\n  const v = await swal({\n    title: '已加入購物車',\n    buttons: [\n      '繼續購物',\n      '前往結帳'\n    ]\n  });\n\n  if (!v) {\n    return;\n  }\n\n  toCartPage();\n}\n\nasync function addon(el) {\n  const apMapId = el.dataset.apMapId;\n\n  try {\n    const res = await u.$http.post(\n      '@cart_ajax/addon',\n      {\n        apMapId\n      }\n    );\n\n    updateCartButton(res.data.data);\n\n    swal({ title: '已加購' });\n\n    return res.data;\n  } catch (e) {\n    console.error(e);\n    u.alert(e.message, '', 'warning');\n  }\n}\n\nfunction buy(el) {\n  sendAddAction(el);\n\n  toCartPage();\n}\n\nfunction toCartPage() {\n  location.href = u.route('cart');\n}\n\nfunction updateCartButton(data) {\n  u.trigger('cart.update', data);\n\n  const count = data.length;\n\n  const $cartButtons = document.querySelectorAll('[data-role=cart-button]');\n\n  for (const $cartButton of $cartButtons) {\n    const $cartQuantity = $cartButton.querySelector('[data-role=cart-quantity]');\n\n    $cartButton.classList.toggle('h-has-items', count > 0);\n    $cartQuantity.textContent = count;\n  }\n}\n"],"mappings":"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"}