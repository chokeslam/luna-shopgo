{"version":3,"file":"product-cart.js","names":["sendAddAction","el","productId","dataset","id","Error","variantId","qtyInput","document","querySelector","quantity","Number","value","attachments","findAttachments","res","u","$http","post","product_id","variant_id","updateCartButton","data","e","console","error","addToCart","alert","message","v","swal","title","buttons","toCartPage","buy","location","href","route","trigger","count","length","$cartButtons","querySelectorAll","$cartButton","$cartQuantity","classList","toggle","textContent","selectAll","attachItems","attachment","idInput","checked","setters","_main","execute","delegate","currentTarget"],"sources":["product-cart.js"],"sourcesContent":["/**\n * Part of shopgo project.\n *\n * @copyright  Copyright (C) 2023 __ORGANIZATION__.\n * @license    __LICENSE__\n */\n\nimport '@main';\n\nu.delegate(document, '[data-task=add-to-cart]', 'click', (e) => {\n  addToCart(e.currentTarget);\n});\n\nu.delegate(document, '[data-task=buy]', 'click', (e) => {\n  buy(e.currentTarget);\n});\n\nasync function sendAddAction(el) {\n  const productId = el.dataset.id;\n\n  if (!productId) {\n    throw new Error('No product ID');\n  }\n\n  const variantId = el.dataset.variantId;\n\n  if (!variantId) {\n    throw new Error('No variant ID');\n  }\n\n  const qtyInput = document.querySelector('[data-role=quantity]');\n  const quantity = Number(qtyInput?.value || 1);\n\n  // Find additional purchases\n  const attachments = findAttachments();\n\n  try {\n    const res = await u.$http.post(\n      '@cart_ajax/addToCart',\n      {\n        product_id: productId,\n        variant_id: variantId,\n        quantity,\n        attachments\n      }\n    );\n\n    updateCartButton(res.data.data);\n\n    return res.data;\n  } catch (e) {\n    console.error(e);\n    throw e;\n  }\n}\n\nasync function addToCart(el) {\n  try {\n    await sendAddAction(el);\n  } catch (e) {\n    u.alert(e.message, '', 'warning');\n    return;\n  }\n\n  const v = await swal({\n    title: '已加入購物車',\n    buttons: [\n      '繼續購物',\n      '前往結帳'\n    ]\n  });\n\n  if (!v) {\n    return;\n  }\n\n  toCartPage();\n}\n\nasync function buy(el) {\n  try {\n    await sendAddAction(el);\n  } catch (e) {\n    u.alert(e.message, '', 'warning');\n    return;\n  }\n\n  toCartPage();\n}\n\nfunction toCartPage() {\n  location.href = u.route('cart');\n}\n\nfunction updateCartButton(data) {\n  u.trigger('cart.update', data);\n\n  const count = data.length;\n\n  const $cartButtons = document.querySelectorAll('[data-role=cart-button]');\n\n  for (const $cartButton of $cartButtons) {\n    const $cartQuantity = $cartButton.querySelector('[data-role=cart-quantity]');\n\n    $cartButton.classList.toggle('h-has-items', count > 0);\n    $cartQuantity.textContent = count;\n  }\n}\n\nfunction findAttachments() {\n  const attachments = u.selectAll('[data-role=attachment]');\n  const attachItems = {};\n\n  for (const attachment of attachments) {\n    const idInput = attachment.querySelector('[data-role=attachment_id]');\n    const qtyInput = attachment.querySelector('[data-role=attachment_quantity]');\n\n    if (idInput.checked) {\n      attachItems[idInput.value] = Number(qtyInput.value);\n    }\n  }\n\n  return attachItems;\n}\n"],"mappings":"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"}